#
# Copyright (c) Istituto Nazionale di Fisica Nucleare (INFN). 2016-2021
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

server:
  address: ${VOMS_AA_HOST:localhost}
  port: ${VOMS_AA_PORT:15000}
  forward-headers-strategy: ${VOMS_FORWARD_HEADERS_STRATEGY:native}
  max-http-header-size: ${MAX_HTTP_HEADER_SIZE:16000}

spring:
  flyway:
    table: schema_version
    enabled: false

  main:
    banner-mode: "off"
    allow-circular-references: true

  jpa:
    open-in-view: ${OPEN_SESSION_IN_VIEW:false}
    
  datasource:
    dataSourceClassName: com.mysql.jdbc.jdbc2.optional.MysqlDataSource
    url: jdbc:mysql://${IAM_DB_HOST}:${IAM_DB_PORT:3306}/${IAM_DB_NAME}?useLegacyDatetimeCode=false&serverTimezone=UTC&useSSL=false
    username: ${IAM_DB_USERNAME}
    password: ${IAM_DB_PASSWORD}
    max-active: ${IAM_DB_MAX_ACTIVE:10}
    max-idle:  ${IAM_DB_MAX_IDLE:5}
    initial-size: ${IAM_DB_INITIAL_SIZE:1}
    test-while-idle: ${IAM_DB_TEST_WHILE_IDLE:true}
    test-on-borrow: ${IAM_DB_TEST_ON_BORROW:true}
    validation-query: ${IAM_DB_VALIDATION_QUERY:SELECT 1}
    time-between-eviction-runs-millis: ${IAM_DB_TIME_BETWEEN_EVICTION_RUNS_MILLIS:5000}
    min-evictable-idle-time-millis: ${IAM_DB_MIN_EVICTABLE_IDLE_TIME_MILLIS:60000}
    
    hikari:
      maximum-pool-size: ${IAM_DB_MAX_ACTIVE:100}
      connection-test-query: ${IAM_DB_VALIDATION_QUERY:SELECT 1}

voms:
  tls:
    certificate-path: ${VOMS_TLS_CERTIFICATE_PATH:/etc/grid-security/voms/hostcert.pem}
    private-key-path: ${VOMS_TLS_PRIVATE_KEY_PATH:/etc/grid-security/voms/hostkey.pem}
    trust-anchors-dir: ${VOMS_TLS_TRUST_ANCHORS_DIR:/etc/grid-security/certificates}
    trust-anchors-refresh-interval-secs: ${VOMS_TLS_TRUST_ANCHORS_REFRESH_INTERVAL_SECS:14400}
  aa:
    host: ${server.address}
    port: ${server.port}
    vo-name: ${VOMS_AA_VO:test}
    optional-group-label: ${VOMS_AA_OPTIONAL_GROUP_LABEL:voms.role}
    use-legacy-fqan-encoding: ${VOMS_AA_USE_LEGACY_FQAN_ENCODING:false}
    max-ac-lifetime-in-seconds: ${VOMS_AA_MAX_AC_LIFETIME_IN_SECONDS:43200}